if [ $DISABLE_SETUP == "true" ]; then
  exit 0
fi

apt-get update
apt-get install -y docker docker-compose nodejs npm

# install gcloud
# echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
# apt-get install -y apt-transport-https ca-certificates gnupg
# curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
# apt-get install -y google-cloud-sdk=297.0.1-0

curl -o- -L https://yarnpkg.com/install.sh | bash

if [ ! -f /usr/local/bin/hasura ]; then
  curl -L https://github.com/hasura/graphql-engine/raw/stable/cli/get.sh | bash
fi

./.github/workflows/scripts/decrypt_creds.sh

PATH=$PATH:$HOME/bin
mkdir -p $HOME/bin

./dishctl.sh install_gcloud_sdk

export PATH=$PATH:"$HOME/bin/google-cloud-sdk/bin"

PWD=$(pwd)
export GOOGLE_APPLICATION_CREDENTIALS="$PWD/k8s/etc/dish-gcloud.enc.json"

# echo "https://gcr.io" | docker-credential-gcr get

eval $(./dishctl.sh yaml_to_env)

echo $TF_VAR_DO_SPACES_ID

export TF_VAR_DO_SPACES_ID
export TF_VAR_DO_SPACES_SECRET
export TF_VAR_HASURA_GRAPHQL_ADMIN_SECRET
export TF_VAR_SENDGRID_API_KEY
export TF_VAR_DO_SPACES_ID
export TF_VAR_DO_SPACES_SECRET
export TF_VAR_HASURA_GRAPHQL_ADMIN_SECRET
export TF_VAR_HASURA_GRAPHQL_ADMIN_SECRET
export TF_VAR_UBEREATS_PROXY
export TF_VAR_HEREMAPS_API_TOKEN
export TF_VAR_INFATUATED_PROXY
export TF_VAR_MICHELIN_PROXY
export TF_VAR_YELP_AWS_PROXY
export TF_VAR_TRIPADVISOR_PROXY
export TF_VAR_GOOGLE_SEARCH_PROXY
export TF_VAR_GOOGLE_AWS_PROXY
export TF_VAR_GOOGLE_USERCONTENT_AWS_PROXY
export TF_VAR_DOORDASH_GRAPHQL_AWS_PROXY
export TF_VAR_GRUBHUB_AWS_PROXY
export TF_VAR_YELP_CDN_AWS_PROXY
export TF_VAR_LUMINATI_PROXY_HOST
export TF_VAR_LUMINATI_PROXY_PORT
export TF_VAR_LUMINATI_PROXY_DATACENTRE_USER
export TF_VAR_LUMINATI_PROXY_DATACENTRE_PASSWORD
export TF_VAR_LUMINATI_PROXY_RESIDENTIAL_USER
export TF_VAR_LUMINATI_PROXY_RESIDENTIAL_PASSWORD
export TF_VAR_DO_SPACES_ID
export TF_VAR_DO_SPACES_SECRET
export TF_VAR_GPT3_KEY
