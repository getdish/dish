- args:
    cascade: false
    read_only: false
    sql: |-
      CREATE OR REPLACE FUNCTION public.tag_triggers()
       RETURNS trigger
       LANGUAGE plpgsql
      AS $function$
      BEGIN
        IF EXISTS (SELECT COUNT(*) > 0 FROM tag WHERE name = NEW.name) THEN
          UPDATE tag SET is_ambiguous = TRUE
            WHERE name = NEW.name
            AND id != NEW.id
            AND is_ambiguous = FALSE;
        ELSE
          UPDATE tag SET is_ambiguous = FALSE
            AND id = NEW.id;
        END IF;

        IF NEW."displayName" IS NULL THEN
          UPDATE tag SET "displayName" = NEW.name WHERE id = NEW.id;
        END IF;

        RETURN NEW;
      END
      $function$;

      CREATE TRIGGER tag_trigger AFTER INSERT OR UPDATE ON "tag" FOR EACH ROW EXECUTE PROCEDURE tag_triggers();
  type: run_sql
