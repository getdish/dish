- args:
    cascade: false
    read_only: false
    sql: |-
      DROP TRIGGER IF EXISTS  menu_item_trigger ON menu_item;
      DROP FUNCTION IF EXISTS  menu_item_defaults_trigger;

      UPDATE menu_item
        SET location = (SELECT location FROM restaurant WHERE restaurant_id = restaurant.id)
        WHERE location IS NULL;

      CREATE FUNCTION menu_item_defaults_trigger() RETURNS TRIGGER AS $$
      BEGIN
        IF new.location IS NULL THEN
          new.location := (SELECT location FROM restaurant WHERE new.restaurant_id = restaurant.id);
        END IF;
        RETURN new;
      END
      $$ language plpgsql;

      CREATE TRIGGER menu_item_trigger BEFORE INSERT OR UPDATE ON menu_item FOR EACH ROW EXECUTE PROCEDURE menu_item_defaults_trigger();
  type: run_sql
